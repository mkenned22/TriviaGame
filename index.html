<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <!-- Added link to the jQuery Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

    <!-- Added a link to Bootstrap-->
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
        crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="https://code.jquery.com/jquery-1.10.2.js"></script>
    <title>Document</title>
    <link rel="stylesheet" type="text/css" media="screen" href="assets/css/style.css" />
</head>
<body>
    <div class="container">
        
    </div>
    <script>
        $(document).ready(function() {
            var intervalId;
            var clockRunning = false;
            var i=0;
            var answerChoices = [];
            var correctAnsers = 0;

            function createPageLayout(){
                $(".container").text("");
                
                var column = $("<div>");
                column.addClass("col-md-12");
                column.attr("id","content");

                var row = $("<div>");
                row.addClass("row");
                $(row).append(column);

                $(".container").append(row);
            }

            function goHome(){
                createPageLayout();
                $("#content").html("<h1>Let's Play Trivia</h1><br>");
                createPlayButton();
            }

            function createPlayButton(){
                var button = $("<button>");
                button.html("<p>Play</p>");
                button.on("click",playGame);
                button.addClass("btn btn-primary btn-lg");
                $("#content").append(button);
            }

            function playGame(){
                createPageLayout();
                
                var title = $("<div>");
                title.attr("id","title");
                $("#content").append(title);

                var question = $("<div>");
                question.attr("id","question");
                $("#content").append(question);
                $("#content").append($("<br>"));
                
                for(j=0;j<4;j++){
                    var answer = $("<div>");
                    answer.attr("id","answer"+j);
                    $("#content").append(answer);
                    $("#content").append($("<br>"));
                }

                var timer = $("<div>");
                timer.attr("id","timer");
                $("#content").append(timer);

                queryURL = "https://opentdb.com/api.php?amount=3&type=multiple"
                $.ajax({
                    url: queryURL,
                    method: "GET"
                    }).then(function(response) {
                    console.log(response);
                    gameData = response.results;
                    getQuestion();
                    });
            }

            function count(){
                time--;
                $("#timer").text("Remaining Time: " + time);
                if(time === 0){
                    displayAnswer();
                }
            }

            function getQuestion(){
                var letters = ["a) ", "b) ", "c) ", "d) "];
                $("#title").html("<h1>Question " +(parseInt(i)+1)+ "</h1>");
                $("#question").html("<h5>" +gameData[i].question+ "</h5>");
                var array = gameData[i].incorrect_answers;
                array.splice(getRandomInt(array.length +1),0,gameData[i].correct_answer);
                for(j=0;j<array.length;j++){
                    var button = $("<button>");
                    var div = $("<div>");
                    button.html("<p>"+letters[j]+array[j]+"</p>");
                    button.attr("id",array[j]);
                    button.on("click",displayAnswer);
                    button.addClass("btn btn-primary btn-lg text-left btn-wrap-text");
                    $("#answer"+j).html(button);
                    
                    
                }

                reset();
                start();
            }

            function displayAnswer(){
                stop();
                var answer = this.id;
                if(time === 0){
                    $("#question").append("<p>Time's up!<br>The correct answer is: " +gameData[i].correct_answer+ "</p>");
                    answerChoices.push('<p class="incorrect">No answer provided</p><p class="correct">&nbsp;&nbsp;'+gameData[i].correct_answer+'</p>')
                }
                else if(answer === gameData[i].correct_answer){
                    correctAnsers++
                    $("#question").append("<p>That is correct!</p>");;
                    answerChoices.push('<p class="correct">'+answer+'</p>');
                }
                else{
                    $("#question").append("<p>That is incorrect!<br>The correct answer is: " +gameData[i].correct_answer+ "</p>");
                    answerChoices.push('<p class="incorrect">'+answer+'</p><p class="correct">&nbsp;&nbsp;'+gameData[i].correct_answer+'</p>')
                }
                
                setTimeout(function(){
                    if(i<gameData.length-1){
                        i++;
                        getQuestion();
                    }
                    else{
                        goGameOver();
                    }    
                },5000)
            }

            function goGameOver(outcome){
                createPageLayout();
                $("#content").html("<div><h1>Game Over</h1></div>")
                $("#content").append("<div><h5>You answered "+correctAnsers+" of "+gameData.length+" questions correctly.</h5></div>")
                for(j=1;j<gameData.length+1;j++){

                    var string = "<div class='correctAnswers'><strong>Question "+j+")</strong> " +gameData[j-1].question+"<br><strong>Your Answer:</strong> "+answerChoices[j-1]+"</div>"
                    $("#content").append(string);
                    $("#content").append($("<br>"));

                }
                i=0;
                correctAnsers = 0;
                answerChoices = [];
                createPlayButton();
            }
            

            function start() {
                if (!clockRunning) {
                intervalId = setInterval(count, 1000);
                clockRunning = true;
                }
            }

            function stop() {
                clearInterval(intervalId);
                clockRunning = false;
            }

            function reset() {
                time = 15;
                $("#timer").text("Remaining Time: " + time);
            }

            function getRandomInt(max) {
                return Math.floor(Math.random() * Math.floor(max));
            }

            goHome();
            
        });
    </script>
</body>
</html>